{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nconst protectedPaths = [\"/admin\", \"/mahasiswa\"];\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  const path = req.nextUrl.pathname;\r\n\r\n  console.log(\"ðŸ” Middleware jalan di:\", req.nextUrl.pathname);\r\n\r\n  async function checkSession() {\r\n    try {\r\n      const res = await fetch(`${req.nextUrl.origin}/api/check-session`, {\r\n        headers: { cookie: req.headers.get(\"cookie\") || \"\" },\r\n        cache: \"no-store\", // âœ… jangan cache session lama\r\n      });\r\n      if (!res.ok) return null;\r\n      const data = await res.json();\r\n      return data;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const session = await checkSession();\r\n\r\n  // ðŸ”¹ Kalau buka /login tapi sudah login â†’ arahkan ke dashboard sesuai role\r\n  if (path === \"/login\") {\r\n    if (session?.user) {\r\n      const redirectUrl =\r\n        session.user.role === \"admin\"\r\n          ? \"/admin/dashboard\"\r\n          : \"/mahasiswa/DashboardMhs\";\r\n      return NextResponse.redirect(new URL(redirectUrl, req.url));\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // ðŸ”¹ Kalau belum login dan mau akses /admin atau /mahasiswa â†’ arahkan ke login\r\n  const isProtected = protectedPaths.some((p) => path.startsWith(p));\r\n  if (isProtected && !session?.user) {\r\n    return NextResponse.redirect(new URL(\"/login\", req.url));\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\"/login\", \"/admin/:path*\", \"/mahasiswa/:path*\"],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,iBAAiB;IAAC;IAAU;CAAa;AAExC,eAAe,WAAW,GAAgB;IAC/C,MAAM,OAAO,IAAI,OAAO,CAAC,QAAQ;IAEjC,QAAQ,GAAG,CAAC,2BAA2B,IAAI,OAAO,CAAC,QAAQ;IAE3D,eAAe;QACb,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,GAAG,IAAI,OAAO,CAAC,MAAM,CAAC,kBAAkB,CAAC,EAAE;gBACjE,SAAS;oBAAE,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;gBAAG;gBACnD,OAAO;YACT;YACA,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;YACpB,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,OAAO;QACT,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,MAAM,UAAU,MAAM;IAEtB,2EAA2E;IAC3E,IAAI,SAAS,UAAU;QACrB,IAAI,SAAS,MAAM;YACjB,MAAM,cACJ,QAAQ,IAAI,CAAC,IAAI,KAAK,UAClB,qBACA;YACN,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,IAAI,GAAG;QAC3D;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,+EAA+E;IAC/E,MAAM,cAAc,eAAe,IAAI,CAAC,CAAC,IAAM,KAAK,UAAU,CAAC;IAC/D,IAAI,eAAe,CAAC,SAAS,MAAM;QACjC,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAU;QAAiB;KAAoB;AAC3D"}}]
}